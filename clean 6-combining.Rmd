---
title: "clean 6-combining"
output: html_notebook
---


I thought about what would be the easiest way to work with the vb, and I decided that it would be easier to do the column manipulation before we lengthen - like what we did with the ids and NAs. I originally added it as 3.5, but this for some reason didn't work, so I tested around with somethings and then tested it out at 2.5, which then worked.


```{r}
library(tidyr)
library(tidyverse)
long_questions <- function(country, country_before, column){
			  #Starting at index 1
			  i <- 1
number_for_dupID <- rep(NA, column)
new_list <- rep(NA, column)
#Replaces original column names with readable version
			  while(i <= column){
			    #Isolates original column names
			    original <- (country$column_name)[i]
			    #Replaces with label
			    new <- attributes(country_before[[original]])$label
			    #Adds object to list
			    new_list[i] <- new
			    #Moves to next item
			    i <- i + 1
			  }
			  new_list
			}
lengthen <- function(country) {
			  country_before <- country
			  country <- country %>%
 #These are excluded because they are repeated
			  select(-strata,-sex, -vb11_10, -vb11_12) %>%
			  #Brings together the following columns
			  gather(column_name, answer, estratopri:vb_combined)
#Takes length of column_name and arguments from long_questions
			  column <- length(country$column_name)
			  questions <- long_questions(country, country_before, column)
 country <- country %>% 
			    mutate(questions)
country <- country %>% 
			    select(pais, year, unique_id, column_name, answer, questions, extra_id)
			  return(country)
			}

```


```{r}
og <- (argentina_long$column_name)[1]
argentina[[og]]
```


```{r}
tidy_spread <- function(x){
  x <- x %>%
    select(-column_name) %>%
    spread(questions, answer)
}
```


```{r}
argentina_wide <- tidy_spread(lengthen(argentina))
belize_wide <- tidy_spread(lengthen(belize))
brazil_wide <- tidy_spread(lengthen(brazil))
chile_wide <- tidy_spread(lengthen(chile))
panama_wide <- tidy_spread(lengthen(panama))
paraguay_wide <- tidy_spread(lengthen(paraguay))
peru_wide <- tidy_spread(lengthen(peru))
suriname_wide <- tidy_spread(lengthen(suriname))
uruguay_wide <- tidy_spread(lengthen(uruguay))
venezuela_wide <- tidy_spread(lengthen(venezuela))
bolivia_wide <- tidy_spread(lengthen(bolivia))
canada_length <- lengthen(canada)
canada_wide <- tidy_spread(canada_length)
colombia_length <- lengthen(colombia)
colombia_wide <- tidy_spread(colombia_length)
costa_wide <- tidy_spread(lengthen(costa))
ecuador_wide <- tidy_spread(lengthen(ecuador))
elsalvador_wide <- tidy_spread(lengthen(elsalvador))
guatemala_wide <- tidy_spread(lengthen(guatemala))
honduras_wide <- tidy_spread(lengthen(honduras))
mexico_wide <- tidy_spread(lengthen(mexico))
nicaragua_wide <- tidy_spread(lengthen(nicaragua))
usa_wide <- tidy_spread(lengthen(usa))
```



```{r}
library(tidyr)
library(tidyverse)
library(dplyr)


argentina_and_belize <- bind_rows(argentina_wide, belize_wide)
bolivia_and_brazil <- bind_rows(bolivia_wide, brazil_wide)
canada_and_chile <- bind_rows(canada_wide, chile_wide)
colombia_and_costa <- bind_rows(colombia_wide, costa_wide)
ecuador_and_elsalvador <- bind_rows(ecuador_wide, elsalvador_wide)
guatemala_and_honduras <- bind_rows(guatemala_wide, honduras_wide)
mexico_and_nicaragua <- bind_rows(mexico_wide, nicaragua_wide)
panama_and_peru <- bind_rows(panama_wide, peru_wide)
suriname_and_usa <- bind_rows(suriname_wide, usa_wide)
uruguay_and_venezuela <- bind_rows(uruguay_wide, venezuela_wide)

  
first_four <- bind_rows(argentina_and_belize, bolivia_and_brazil)
second_four <- bind_rows(canada_and_chile, colombia_and_costa)
first_and_second <- bind_rows(first_four, second_four)

third_four <- bind_rows(ecuador_and_elsalvador, guatemala_and_honduras)
third_and_fourth <- bind_rows(third_four, mexico_and_nicaragua)

fifth_four <- bind_rows(panama_and_peru, suriname_and_usa)
sixth_four <- bind_rows(fifth_four, uruguay_and_venezuela)
last <- bind_rows(sixth_four, paraguay)

first_half <- bind_rows(first_and_second, third_and_fourth)

last_combine <- bind_rows(first_half, last)

write_csv(last_combine, "combined_tidy.csv")
```
