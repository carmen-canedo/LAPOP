---
title: "Exploring Tidy Data"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---




##Lengthening the data set
```{r}
library(tidyverse)
library(devtools)
library(fs)

#Function for reducing columns
lengthen <- function(country) {
  country <- country %>%
  gather(column_name, answer, estratopri:formatq) %>%
  select(pais, year, unique_id, column_name, answer)
  return(country)
}


```

##Applying above functions to every country
```{r}
#Adds all the countries, in correct tidy format into a large data set

library(purrr)
countries <- list(uruguay, venezuela)

uruguay_and_venezuela <- map_df(countries, lengthen)

paraguay <- lengthen(paraguay)


#Then adds a column to the merged data set that distinguishes if the question is universal or not

#everything <- everything %>% mutate(common = column_name %in% all_common_col)


```

```{r}
library(purrr)

countries_2016 <- list(venezuela_2016_17, bolivia_2016_17, brazil_2016_17, canada_2016_17, chile_2016_17, colombia_2016_17,costa_2016_17, ecuador_2016_17, elsalvador_2016_17, guatemala_2016_17, guyana_2016_17, honduras_2016_17, jamaica_2016_17, mexico_2016_17, nicaragua_2016_17, panama_2016_17, paraguay_2016_17, peru_2016_17, usa_2016_17, uruguay_2016_17)

every_2016 <- map_dfr(countries_2016, shrink)

```

```{r}
library(tidyr)
library(tidyverse)
library(dplyr)

try <- function(x){
  x <- x %>% group_by(column_name) %>% mutate(grouped_id = row_number())
  x %>% spread(key = column_name, value = answer) %>% select(-grouped_id)
}

# argentina_and_belize <- argentina_and_belize %>%
#   spread(key = column_name, value = answer)

#skipped because Error: Each row of output must be identified by a unique combination of keys

#canada_and_chile <- try(canada_and_chile)
#bolivia_and_brazil <- try(bolivia_and_brazil)

#colombia_and_costa <- try(colombia_and_costa)

#ecuador_and_elsalvador <- try(ecuador_and_elsalvador)
#guatemala_and_guyana <- try(guatemala_and_guyana)

#first_four <- bind_rows(argentina_and_belize, bolivia_and_brazil)

#second_four <- bind_rows(canada_and_chile, colombia_and_costa)
#first_and_second <- bind_rows(first_four, second_four)

#third_four <- bind_rows(ecuador_and_elsalvador, guatemala_and_guyana)

#honduras_and_jamaica <- try(honduras_and_jamaica)
#mexico_and_nicaragua <- try(mexico_and_nicaragua)

#fourth_four <- bind_rows(honduras_and_jamaica, mexico_and_nicaragua)

#third_and_fourth <- bind_rows(third_four, fourth_four)

#panama_and_peru <- try(panama_and_peru)
 
#suriname_and_usa <- try(suriname_and_usa)

#fifth_four <- bind_rows(panama_and_peru, suriname_and_usa)

#uruguay_and_venezuela <- try(uruguay_and_venezuela)

#sixth_four <- bind_rows(fifth_four, uruguay_and_venezuela)

#paraguay <- try(paraguay)

#last <- bind_rows(sixth_four, paraguay)

#first_half <- bind_rows(first_and_second, third_and_fourth)

#last_combine <- bind_rows(first_half, last)

write_csv(last_combine, "combined_tidy.csv")



```



